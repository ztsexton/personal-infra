# Bootstrap secret for 1Password Connect credentials
# The Connect token secret is created automatically by Terraform
# This External Secret will sync the credentials file from 1Password
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: onepassword-credentials
  namespace: onepassword
  annotations:
    # Wait for the token secret to exist before trying to sync
    argocd.argoproj.io/sync-wave: "10"
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: onepassword-store
    kind: SecretStore
  target:
    name: op-credentials
    creationPolicy: Owner
  data:
  - secretKey: 1password-credentials.json
    remoteRef:
      key: "1password-connect-credentials"  # Item name in 1Password
      property: "credentials"  # Field name in the item
